<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Constant HTML Traffic: download static files to create HTML traffic </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8">
        <link rel="stylesheet" href="NiceLookingHtml.css">
        <script>
            startTime = "23"
            var files = ['size___1k.txt', 'size__10k.txt', 'size_100k.txt', 'size1000k.txt']

            function doOnload()
            {
                automatic();
            }


            async function downloadAsync (filename) /* filename == "size___1k.txt" */
            {
                const perfTable = document.getElementById("uiPerfTable"); //.tBodies[0];
                const tbody = perfTable.tBodies[0]
                console.log("perfTable=" + perfTable)
                startTime=new Date();

                const response  = await fetch(filename)
                const result = await response.arrayBuffer();
                len = result.byteLength
                sizeKB=(len / (1024));
                sizeMB=(len / (1024*1024));
                deltaMS=(new Date()) - startTime;
                deltaS=deltaMS / 1000
                speedInMbs=(sizeMB*8) / (deltaS);
                console.log("Go it! size=" + len + " delta="+deltaMS +" speed="+speedInMbs); 
                var row = tbody.insertRow(0);
                row.insertCell(0).innerHTML = HMS(startTime);
                row.insertCell(1).innerHTML = sizeKB.toFixed(1);
                row.insertCell(2).innerHTML = deltaMS;
                row.insertCell(3).innerHTML = speedInMbs.toFixed(3);
            }
            async function automatic()
            {
                for (var fileno = 0; fileno < files.length; fileno++)
                {
                    for (var i=0; i<5; i++)
                    {
                        const file = files[fileno];
                        await downloadAsync(file)
                    };
                }
           }

            function HMS(date)
            {
                var retval = NumPad(date.getHours(),2)
                    + ":" + NumPad(date.getMinutes(), 2)
                    + ":" + NumPad(date.getSeconds(), 2);
                return retval;
            }
            function NumPad(number, padding)
            {
                var retval = ("00000000000000000" + number).slice(-padding);
                return retval;
            }
        </script>
    </head>
    <body onload="doOnload()">
        <h1>Manual test: Press a button to get a file</h1>
        <div>
            <button onclick="downloadAsync('size___1k.txt')" type="button" name="uiStart">1k!</button>
            <button onclick="downloadAsync('size__10k.txt')" type="button" name="uiStart">10k!</button>
            <button onclick="downloadAsync('size_100k.txt')" type="button" name="uiStart">100k!</button>
            <button onclick="downloadAsync('size1000k.txt')" type="button" name="uiStart">1000k!</button>

        </div>

        <div style="height:300px; overflow: auto;" >
            <!-- I want the table to scroll -->
            <table id="uiPerfTable" class="styled-table" style="max-height:80%;">
                <thead>
                    <tr><th>Start</th><th>Size (kb)</th><th>Time (ms)</th><th>Speed (Mbs)</th></tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
        
        <div name="uiLog" class="log-text">
        </div>
        <aside>
            <h1>Setting up the files and tools</h1>
            This project uses IIS Express to serve files. There's less than 10 files total: an HTML file, some data files, and a run.bat and other ancilary files.
    
            <h2>IIS 10.0 Express</h2>
            I'm following the <a href="https://learn.microsoft.com/en-us/iis/extensions/introduction-to-iis-express/iis-express-overview">instructions</a> on learn.microsoft.com.
            <ol>
                <li>Download <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48264">IIS 10.0 Express</a>. Be **sure** to download the 64-bit version -- all of the x86 versions will fail on modern windows.</li>
                <li>Install it in the obvious way</li>
                <li>There's a <pre>run.bat</pre> file that runs IIS Express. Really, it just gives a path to this directory.</li>
            </ol>

            Contents of run.bat:
            <pre>
REM Runs IIS Express
set IISEXPRESS="\Program Files (x86)\IIS Express\iisexpress"
set WEBAPP="C:\HtmlApps\ConstantHTMLTraffic"

%IISEXPRESS% /trace:info /path:%WEBAPP%
            </pre>
        </aside>

        <aside>
            <h1>Using GIT commands here</h1>
            Cheata sheet for git command line newbies like me.
            <h2>I changed a file, now what How do I get it into the cloud github?</h2>
            <ol>
                <li><tt>git diff</tt> to see files that you've changed</li>
                <li><tt>git add FILENAME</tt> to tell git you care about the changes</li>
                <li><tt>git commit</tt> to tell git you really care about the changes</li>
                <li><tt>gh pr create</tt> might not actually be needed?</li>
                <li><tt>git push</tt> to tell git you really, really care about the changes and they should be up in the cloud</li>
            </ol> 
        </aside>

        <aside>
            <h1>Testing over Wi-Fi versus Mobile Hotspot</h1>

            <h2>Testing locally</h2>
            <ol>
                <li>You'll need the IIS Express set up (see instructions above)</li>
                <li>Get the current files with <tt>gh repo clone pedasmith/ConstantHtmlTraffic</tt>. CD to a good directory (like <tt>c:\\HtmlApps</tt>) and run the command. The result should be a directory c:\\HtmlApps\\ConstantHtmlTraffic with the run.bat file</li>
                <li>In a cmd prompt, run "run.bat". This starts the IIS Express at the right directory</li>
                <li>In a web browser, go to <a href="http://localhost:8080/ConstantHTMLTraffic.html">http://localhost:8080/ConstantHTMLTraffic.html</a></li>
                <li>You'll see some resuts in the table</li>
            </ol>
        </aside>
    </body>
</html>
 